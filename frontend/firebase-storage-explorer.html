<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Storage íƒìƒ‰ê¸°</title>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getStorage, ref, listAll, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';

        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyCKb2Rs9vOF6pppEO_HfQ3Qub5L9OACAng",
            authDomain: "easypicks-delivery.firebaseapp.com",
            projectId: "easypicks-delivery",
            storageBucket: "easypicks-delivery.firebasestorage.app",
            messagingSenderId: "992445415586",
            appId: "1:992445415586:web:2e00d58272a1107ca4d7fb"
        };

        const app = initializeApp(firebaseConfig);
        const storage = getStorage(app);

        // ì „ì²´ íŒŒì¼ ëª©ë¡ ì¡°íšŒ
        async function listAllFiles() {
            try {
                console.log('ğŸ” Firebase Storage íŒŒì¼ íƒìƒ‰ ì‹œì‘...');
                const storageRef = ref(storage, 'delivery-photos');
                const result = await listAll(storageRef);
                
                document.getElementById('status').textContent = 'ë¡œë”© ì¤‘...';
                const fileList = document.getElementById('fileList');
                fileList.innerHTML = '';
                
                // í´ë” ëª©ë¡
                for (const folderRef of result.prefixes) {
                    console.log('ğŸ“ í´ë” ë°œê²¬:', folderRef.name);
                    
                    const folderDiv = document.createElement('div');
                    folderDiv.style.marginBottom = '20px';
                    folderDiv.innerHTML = `<h3>ğŸ“ ${folderRef.name}</h3>`;
                    
                    // í´ë” ë‚´ íŒŒì¼ ëª©ë¡
                    const folderResult = await listAll(folderRef);
                    const fileGrid = document.createElement('div');
                    fileGrid.style.display = 'grid';
                    fileGrid.style.gridTemplateColumns = 'repeat(auto-fill, minmax(200px, 1fr))';
                    fileGrid.style.gap = '10px';
                    
                    for (const itemRef of folderResult.items) {
                        const url = await getDownloadURL(itemRef);
                        console.log('ğŸ“· íŒŒì¼:', itemRef.name, url);
                        
                        const fileDiv = document.createElement('div');
                        fileDiv.style.border = '1px solid #ddd';
                        fileDiv.style.borderRadius = '8px';
                        fileDiv.style.padding = '10px';
                        fileDiv.innerHTML = `
                            <img src="${url}" alt="${itemRef.name}" style="width: 100%; height: 150px; object-fit: cover; border-radius: 4px;">
                            <p style="margin: 5px 0 0 0; font-size: 12px; word-break: break-all;">${itemRef.name}</p>
                            <a href="${url}" target="_blank" style="font-size: 11px; color: blue;">ë‹¤ìš´ë¡œë“œ</a>
                        `;
                        fileGrid.appendChild(fileDiv);
                    }
                    
                    folderDiv.appendChild(fileGrid);
                    fileList.appendChild(folderDiv);
                }
                
                document.getElementById('status').textContent = `âœ… ì´ ${result.prefixes.length}ê°œ í´ë” ë°œê²¬`;
                
            } catch (error) {
                console.error('âŒ íŒŒì¼ ëª©ë¡ ì¡°íšŒ ì˜¤ë¥˜:', error);
                document.getElementById('status').textContent = `âŒ ì˜¤ë¥˜: ${error.message}`;
            }
        }

        // íŠ¹ì • ë°°ì†¡ ë²ˆí˜¸ì˜ íŒŒì¼ ì¡°íšŒ
        async function listDeliveryPhotos() {
            const trackingNumber = document.getElementById('trackingInput').value.trim();
            if (!trackingNumber) {
                alert('ë°°ì†¡ ì¶”ì  ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            try {
                console.log('ğŸ” ë°°ì†¡ ì‚¬ì§„ ì¡°íšŒ:', trackingNumber);
                const folderRef = ref(storage, `delivery-photos/${trackingNumber}`);
                const result = await listAll(folderRef);
                
                const photoList = document.getElementById('photoList');
                photoList.innerHTML = `<h3>ğŸ“· ${trackingNumber} ë°°ì†¡ ì‚¬ì§„</h3>`;
                
                if (result.items.length === 0) {
                    photoList.innerHTML += '<p>âŒ í•´ë‹¹ ë°°ì†¡ ë²ˆí˜¸ì˜ ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }
                
                const photoGrid = document.createElement('div');
                photoGrid.style.display = 'grid';
                photoGrid.style.gridTemplateColumns = 'repeat(auto-fill, minmax(250px, 1fr))';
                photoGrid.style.gap = '15px';
                
                for (const itemRef of result.items) {
                    const url = await getDownloadURL(itemRef);
                    console.log('ğŸ“· ì‚¬ì§„:', itemRef.name, url);
                    
                    const photoDiv = document.createElement('div');
                    photoDiv.style.border = '2px solid #e5e5e5';
                    photoDiv.style.borderRadius = '12px';
                    photoDiv.style.padding = '15px';
                    photoDiv.style.backgroundColor = '#f9f9f9';
                    photoDiv.innerHTML = `
                        <img src="${url}" alt="${itemRef.name}" style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px; margin-bottom: 10px;">
                        <p style="margin: 0; font-weight: bold; font-size: 14px;">${itemRef.name}</p>
                        <a href="${url}" target="_blank" style="color: #007bff; text-decoration: none; font-size: 13px;">ğŸ”— ì›ë³¸ ë³´ê¸°</a>
                    `;
                    photoGrid.appendChild(photoDiv);
                }
                
                photoList.appendChild(photoGrid);
                
            } catch (error) {
                console.error('âŒ ë°°ì†¡ ì‚¬ì§„ ì¡°íšŒ ì˜¤ë¥˜:', error);
                document.getElementById('photoList').innerHTML = `<p>âŒ ì˜¤ë¥˜: ${error.message}</p>`;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        window.addEventListener('load', () => {
            document.getElementById('listAllBtn').addEventListener('click', listAllFiles);
            document.getElementById('searchBtn').addEventListener('click', listDeliveryPhotos);
            
            // ìë™ìœ¼ë¡œ ì „ì²´ ëª©ë¡ ë¡œë“œ
            listAllFiles();
        });
    </script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
            background-color: #f5f5f5;
        }
        .container { 
            background: white; 
            padding: 30px; 
            border-radius: 12px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        button { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 14px;
            margin-right: 10px;
        }
        button:hover { background: #0056b3; }
        input { 
            padding: 10px; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
            width: 200px; 
            margin-right: 10px;
        }
        #status { 
            font-weight: bold; 
            margin: 15px 0; 
            padding: 10px;
            background: #e7f3ff;
            border-radius: 4px;
        }
        h1 { color: #333; margin-bottom: 20px; }
        h2 { color: #555; border-bottom: 2px solid #007bff; padding-bottom: 5px; }
    </style>
</head>
<body>
    <h1>ğŸ”¥ Firebase Storage íƒìƒ‰ê¸°</h1>
    
    <div class="container">
        <h2>ğŸ“‚ ì „ì²´ íŒŒì¼ ëª©ë¡</h2>
        <button id="listAllBtn">ğŸ”„ ì „ì²´ íŒŒì¼ ìƒˆë¡œê³ ì¹¨</button>
        <div id="status">ë¡œë”© ì¤‘...</div>
        <div id="fileList"></div>
    </div>
    
    <div class="container">
        <h2>ğŸ” íŠ¹ì • ë°°ì†¡ ë²ˆí˜¸ ê²€ìƒ‰</h2>
        <input type="text" id="trackingInput" placeholder="ë°°ì†¡ ì¶”ì  ë²ˆí˜¸ ì…ë ¥" value="">
        <button id="searchBtn">ğŸ” ê²€ìƒ‰</button>
        <div id="photoList"></div>
    </div>
    
    <div class="container">
        <h2>ğŸ“– ì‚¬ìš©ë²•</h2>
        <ul>
            <li><strong>ì „ì²´ ëª©ë¡</strong>: Firebase Storageì˜ ëª¨ë“  delivery-photos í´ë” ë‚´ìš©ì„ í‘œì‹œ</li>
            <li><strong>íŠ¹ì • ê²€ìƒ‰</strong>: ë°°ì†¡ ì¶”ì  ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì—¬ í•´ë‹¹ ë°°ì†¡ì˜ ì‚¬ì§„ë§Œ ì¡°íšŒ</li>
            <li><strong>ë‹¤ìš´ë¡œë“œ</strong>: ê° ì´ë¯¸ì§€ì˜ "ë‹¤ìš´ë¡œë“œ" ë˜ëŠ” "ì›ë³¸ ë³´ê¸°" ë§í¬ í´ë¦­</li>
            <li><strong>ìƒˆë¡œê³ ì¹¨</strong>: "ì „ì²´ íŒŒì¼ ìƒˆë¡œê³ ì¹¨" ë²„íŠ¼ìœ¼ë¡œ ìµœì‹  ìƒíƒœ í™•ì¸</li>
        </ul>
    </div>
</body>
</html>