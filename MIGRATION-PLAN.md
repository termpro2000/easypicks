# Railway → Gabia 마이그레이션 계획

## 개요
기존 Railway 백엔드를 그대로 유지하면서 가비아용 별도 백엔드를 구축하여 점진적 마이그레이션을 진행합니다.

## 디렉토리 구조
```
hy2/
├── backend/          # 기존 Railway용 (Node.js 18) - 현재 운영 중
├── backend-gabia/    # 신규 가비아용 (Node.js 22) - 마이그레이션 대상
└── MIGRATION-PLAN.md # 이 파일
```

## 마이그레이션 진행 상황

### ✅ 완료된 작업
1. **가비아용 백엔드 디렉토리 생성**
   - `backend-gabia/` 디렉토리 생성
   - 기존 소스코드 복사

2. **Node.js 22 호환성 업그레이드**
   - package.json 업데이트 (v2.0.0)
   - Express.js 4.21.1 (최신 안정 버전)
   - 기타 패키지 최신화
   - Node.js 22.18.0에서 정상 동작 확인 ✅

3. **가비아 특화 설정**
   - `.env.example` 가비아 환경변수 템플릿
   - `gabia-deploy.sh` 배포 스크립트
   - `README-GABIA.md` 가비아 배포 가이드
   - Railway 관련 파일 제거 (railway.json, Dockerfile.bak)

4. **호환성 테스트**
   - ✅ 서버 시작 성공
   - ✅ Health check 엔드포인트 동작
   - ✅ Products API 정상 동작
   - ✅ JWT 인증 정상 동작
   - ✅ MySQL 연결 정상 동작

### 🔄 진행 예정 작업

#### 1단계: 로컬 환경 완전 검증
- [ ] Socket.IO 실시간 기능 테스트
- [ ] 파일 업로드 기능 테스트
- [ ] 모든 API 엔드포인트 검증
- [ ] 부하 테스트

#### 2단계: 가비아 환경 구축
- [ ] 가비아 컨테이너 호스팅 신청 (스탠다드 무제한 - 22,000원/월)
- [ ] SSH 접속 및 Node.js 22 설치
- [ ] PM2 설치 및 설정
- [ ] 환경변수 설정 (.env)
- [ ] SSL 인증서 설정

#### 3단계: 가비아 배포 및 테스트
- [ ] 소스코드 업로드 (SFTP/Git)
- [ ] 의존성 설치 및 서버 시작
- [ ] Database 연결 확인
- [ ] 모든 기능 테스트
- [ ] 성능 및 안정성 확인

#### 4단계: 점진적 트래픽 이전
- [ ] 가비아 서버를 테스트 환경으로 사용
- [ ] 프론트엔드에서 API URL 환경별 분리
- [ ] 일부 기능부터 가비아로 라우팅
- [ ] 모니터링 및 성능 비교

#### 5단계: 완전 이전
- [ ] 도메인 DNS 변경
- [ ] 프론트엔드 API URL 완전 전환
- [ ] Railway 서비스 중단
- [ ] 모니터링 및 안정화

## 기술적 변경사항

### Node.js 버전
- **기존**: Node.js 18.x (2025.04.30 EOL)
- **신규**: Node.js 22.18.0 (현재 LTS)

### 패키지 업데이트
```json
{
  "express": "4.18.2 → 4.21.1",
  "express-session": "1.17.3 → 1.18.1", 
  "express-rate-limit": "6.7.0 → 7.4.1",
  "mysql2": "3.6.0 → 3.11.4",
  "dotenv": "16.3.1 → 16.4.7",
  "nodemon": "3.0.1 → 3.1.7",
  "jest": "29.6.2 → 29.7.0"
}
```

### 환경 설정 변경
- Railway 특화 설정 제거
- 가비아 컨테이너 호스팅 최적화
- 파일 업로드 경로 조정
- PM2 프로세스 관리 도입

## 비용 분석

### Railway (현재)
- 사용량 기반 과금
- 예상 월 비용: $20-40 (약 26,000-52,000원)

### 가비아 컨테이너 호스팅 (예정)
- 고정 요금제: 22,000원/월
- 트래픽 무제한
- **예상 절약**: 월 4,000-30,000원

## 리스크 관리

### 롤백 계획
1. 문제 발생 시 프론트엔드 API URL을 Railway로 즉시 변경
2. DNS 설정 원복 (TTL: 300초로 설정)
3. 가비아 환경 디버깅 후 재시도

### 모니터링
- 응답 시간 비교 (Railway vs Gabia)
- 에러율 모니터링
- 사용자 피드백 수집

## 예상 일정
- **1단계**: 1-2일 (로컬 검증)
- **2단계**: 1일 (가비아 환경 구축)
- **3단계**: 2-3일 (배포 및 테스트)
- **4단계**: 1주일 (점진적 이전)
- **5단계**: 1일 (완전 이전)

**총 예상 기간**: 2-3주

## 성공 지표
- [ ] 모든 기능 정상 동작
- [ ] 응답 시간 기존 대비 동등 이상
- [ ] 99.9% 가용성 유지
- [ ] 사용자 불편 최소화
- [ ] 월 비용 20% 이상 절약

---

**최종 업데이트**: 2025-09-22
**상태**: Node.js 22 호환성 검증 완료, 가비아 환경 구축 준비 중